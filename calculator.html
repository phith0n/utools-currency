<!DOCTYPE html>
<html>

<head>
    <title>在线汇率计算器</title>
</head>

<body>
    <div id='gcw_mainF6EiNdyHx' class='gcw_mainF6EiNdyHx'></div>
    <h4 id='gcw_tipF6EiNdyHx' align="center"></h4>
    <script>
        function loadConverter() {
            showTips('正在加载最新汇率...');
            url = 'https://freecurrencyrates.com/zh-hans/widget-vertical?iso=CNY-XUM-USD-JPY-KRW-HKD-TWD-THB-EUR-GBP-RUB-AUD-CAD&df=1&p=F6EiNdyHx&v=fits&source=fcr&width=1000&width_title=0&firstrowvalue=1&thm=cccccc,F9F9F9,A3A3A3,333333,eeeeee,cccccc,ffffff,222222,000000&title=%E8%B4%A7%E5%B8%81%E6%8D%A2%E7%AE%97%E5%99%A8&tzo=-480'
            var sc = document.getElementById('scF6EiNdyHx');
            if (sc) sc.parentNode.removeChild(sc);
            sc = document.createElement('script');
            sc.type = 'text/javascript';
            sc.charset = 'UTF-8';
            sc.async = false;
            sc.id = 'scF6EiNdyHx';
            // sc.src = url;
            loadExchangeRate(url);
            var div = document.getElementById('gcw_mainF6EiNdyHx');
            div.parentNode.insertBefore(sc, div);
        }

        function loadExchangeRate(url) {
            var xhr = new XMLHttpRequest();
            xhr.open("get", url, true)
            xhr.send();
            xhr.onreadystatechange = function () {
                if (xhr.status == 200) {
                    hiddenTips();
                    eval(xhr.responseText);
                    // changeCNY(1);
                } else {
                    refreshButton = '<a href="javascript:loadConverter()">这里</a>';
                    showTips("加载失败！请检查网络或点击" + refreshButton + "重试");
                }
            }
            return;
        }

        function showTips(tips) {
            document.getElementById('gcw_tipF6EiNdyHx').innerHTML = tips;
            document.getElementById('gcw_tipF6EiNdyHx').style.display = "block";
        }

        function hiddenTips() {
            document.getElementById('gcw_tipF6EiNdyHx').style.display = "none";
        }

        function changeCNY(moneyValue) {
            document.getElementById('gcw_valF6EiNdyHx0').value = moneyValue;
            gcw_handlerF6EiNdyHx.update(0);
        }

        loadConverter();

        // utools input change event
        utools.onPluginEnter(({ code, type, payload }) => {
            utools.setSubInput(({ text }) => {
                self.command = text
                changeCNY(text)
            }, '请输人民币金额(自动转换)')
        })


        // handler
        var gcw_handlerF6EiNdyHx = {
            gennodes: function () {
                this.nodes = [];
                for (var i = 0; i < 13; i++) {
                    var id = 'gcw_valF6EiNdyHx' + i;
                    var node = document.getElementById(id);
                    node.rate = node.getAttribute('rate');
                    this.nodes[i] = node;
                }
            },
            format: function (rate) {
                if (isNaN(rate)) return "0";
                rate = parseFloat(rate);
                if (rate > 1) rate = rate.toFixed(2);
                var i = Math.floor(rate), r = rate - i;
                if (r != 0) {
                    var pr = 3;
                    if (i > 0) pr = 2;
                    else for (var c = r; c < 1; c *= 10) pr++;
                    r = r.toFixed(pr).toString().substr(1).replace(/0+$/, '');
                } else r = '';
                return i.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + r;
            },
            parse: function (str) {
                return parseFloat(str.replace(/[^0-9E\+\-\.]+/g, ''))
            },
            update: function (idx, self) {
                if (!this.nodes) this.gennodes();
                console.log(this.nodes)
                console.log(this.gennodes())
                var usd = this.parse(this.nodes[idx].value) / this.nodes[idx].rate;
                if (isNaN(usd)) return;
                for (var i = 0; i < 13; i++)
                    if (i != idx || self) this.nodes[i].value = this.format(this.nodes[i].rate * usd);
            },
            reload: function () {
                loadConverter();
            }
        };

    </script>
    <!-- put custom styles here: .gcw_mainF6EiNdyHx{}, .gcw_headerF6EiNdyHx{}, .gcw_ratesF6EiNdyHx{}, .gcw_sourceF6EiNdyHx{} -->
    <!--End of Currency Converter widget by FreeCurrencyRates.com -->
    <style type="text/css">
        .gcw_ttlF6EiNdyHx {
            width: 50% !important;
        }

        .gcw_valblockF6EiNdyHx {
            width: 50% !important;
        }
    </style>
</body>

</html>